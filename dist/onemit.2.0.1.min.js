/*
 MIT
   @version 2.0.1
   @repo    https://github.com/duzun/onemit
*/
(function(A,r,x){function u(e,g){for(var b in g)v.call(g,b)&&(e[b]=g[b]);return e}function B(e,g){for(var b=e.length,n,a=1,h,c=arguments.length,d;a<c;++a)for(d=arguments[a],e.length=h=b+d.length,n=0;b<h;++b,++n)e[b]=d[n];return e}var w=x+"",v={}.hasOwnProperty,t=[].slice,C=[].splice,y=v.bind,D=typeof setTimeout!=w?setTimeout:r.setTimeout,E=typeof setImmediate!=w?setImmediate:r.setImmediate,z=typeof Promise!=w?Promise:r.Promise;("function"===typeof define&&define.amd?define:typeof module!=w&&module.exports?
function(e,g){module.exports=g()}:function(e,g){r[A]=g()})([],function(){function e(a){if(a)return u(a,e.prototype)}function g(a){if(!(this instanceof g))return new g(a);a==x&&(a="");"string"==typeof a&&(a={type:a});u(this,a);this.timeStamp=Date.now()}function b(a,h){var c=this._callbacks||(this._callbacks={}),d=a.type||String(a);return c[d]||h&&(c[d]=[])||[]}function n(a,h,c){var d=e.Promise||z,f=this;c=+c;var m=!c&&(e.setImmediate||E)||e.setTimeout||D;return new d(function(d,e){m(function(){try{d(a.apply(f,
h))}catch(c){e(c)}},c)})}u(g.prototype,{type:"*",toString:function(){return this.type}});u(e.prototype,{on:function(a,h){b.call(this,a,!0).push(h);return this},only:function(a,h){var c=b.call(this,a,!0);0>c.indexOf(h)&&c.push(h);return this},once:function(a,h){function c(){this.off(a,c);h.apply(this,arguments)}c.fn=h;return this.on(a,c)},off:function(a,h){var c=this._callbacks;if(!c)return this;if(0==arguments.length)return c&&(this._callbacks={}),this;var d=c[a];if(!d)return this;if(1==arguments.length)return delete c[a],
this;for(var f=d.length;f--;)c=d[f],c!==h&&c.fn!==h||C.call(d,f,1);return this},emit:function(a,h,c){var d,f,e=[],q=new g(a);q.result=e;if(!(d=this._callbacks))return q;f=d[q.type];d=d["*"];if(f&&f.length)f=d&&d.length?f.concat(d):t.call(f,0);else if(d&&d.length)f=t.call(d,0);else return q;d=t.call(arguments,0);var b=f.length,l=0,k;for(d[0]=q;l<b;++l)k=f[l].apply(this,d),k!==x&&e.push(k);return q},emitAfter:function(a,h,c,d){var f=e.Promise||z,m,b,p=[],l=+("number"==typeof a),k=new g(arguments[l]);
k.result=p;if(!(m=this._callbacks))return f.resolve(k);b=m[k.type];m=m["*"];if(b&&b.length)b=m&&m.length?b.concat(m):b;else if(m&&m.length)b=m;else return f.resolve(k);m=b.length;var r=t.call(arguments,l);r[0]=k;for(l?l=0:a=0;l<m;++l)p[l]=n.call(this,b[l],r,a);return f.all(p).then(function(a){k.result=a;return k})},emitAsync:function(a,h,c){var d=e.Promise||z,f,b,q=[],p=new g(a);p.result=q;if(!(f=this._callbacks))return d.resolve(p);b=f[p];f=f["*"];if(b&&b.length)b=f&&f.length?b.concat(f):b;else if(f&&
f.length)b=f;else return d.resolve(p);f=b.length;var l=t.call(arguments,0),k=0;for(l[0]=p;k<f;++k)q[k]=n.call(this,b[k],l);return d.all(q).then(function(a){p.result=a;return p})},bind:function(a){var b=e.prototype,c;for(c in b)v.call(b,c)&&"function"==typeof b[c]&&(a[c]=y.call(b[c],this));return a},hasListeners:function(a){a=b.call(this,a,!1);return!(!a||!a.length)},hasListener:function(a,e){!e&&a&&(e=a,a="*");if("*"!=a){var c=b.call(this,a,!1);return!(!c||!~c.indexOf(e))}var c=this._callbacks,d;
for(d in c)if(v.call(c,d)&&-1<c[d].indexOf(e))return!0;return!1},listeners:b});e.Event=g;return e});"function"!=typeof y&&(y=function(e){var g=t.call(arguments,1),b=this,n=function(){},a=g.length?function(){var a=arguments;return b.apply(this instanceof n&&e?this:e,a.length?B(g,a):g)}:function(){return b.apply(this instanceof n&&e?this:e,arguments)};n.prototype=b.prototype;a.prototype=new n;return a})})("OnEmit","undefined"==typeof self?"undefined"==typeof global?this:global:self);