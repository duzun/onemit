/*
 MIT
   @version 2.1.0
   @repo    https://github.com/duzun/onemit
*/
(function(m,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):(m=m||self,m.OnEmit=n())})(this,function(){function m(a){if(a)return r(a,m.prototype)}function n(a){if(!(this instanceof n))return new n(a);void 0==a&&(a="");"string"==typeof a&&(a={type:a});r(this,a);this.timeStamp=Date.now()}function p(a,c){var b=this._callbacks||(this._callbacks={}),h=a.type||String(a);return b[h]||c&&(b[h]=[])||[]}function y(a,c,b){var h=m.Promise||
w,e=this;b=+b;var f=x(b);return new h(function(d,g){f(function(){try{d(a.apply(e,c))}catch(k){g(k)}},b)})}function x(a){var c=a?m.setTimeout||A:m.setImmediate||B;if(!c){if(!t){t||(t=u);var b=t;if(b)return x(a)}if(!a)return x(1)}return c}function r(a,c){for(var b in c)v.call(c,b)&&(a[b]=c[b]);return a}var u="undefined"==typeof globalThis?"undefined"==typeof global?self:global:globalThis,v={}.hasOwnProperty,C=v.bind,z=[],q=z.slice,D=z.splice,A="undefined"!=typeof setTimeout?setTimeout:u.setTimeout,
B="undefined"!=typeof setImmediate?setImmediate:u.setImmediate,w="undefined"!=typeof Promise?Promise:u.Promise,t;r(n.prototype,{type:"*",toString:function(){return this.type}});r(m.prototype,{on:function(a,c){p.call(this,a,!0).push(c);return this},only:function(a,c){var b=p.call(this,a,!0);0>b.indexOf(c)&&b.push(c);return this},once:function(a,c){function b(){this.off(a,b);c.apply(this,arguments)}b.fn=c;return this.on(a,b)},off:function(a,c){var b=this._callbacks;if(!b)return this;if(0==arguments.length)return b&&
(this._callbacks={}),this;var h=b[a];if(!h)return this;if(1==arguments.length)return delete b[a],this;for(var e=h.length;e--;)b=h[e],b!==c&&b.fn!==c||D.call(h,e,1);return this},emit:function(a,c,b){var h=[],e=new n(a);e.result=h;var f;if(!(f=this._callbacks))return e;var d=f[e.type];f=f["*"];if(d&&d.length)d=f&&f.length?d.concat(f):q.call(d,0);else if(f&&f.length)d=q.call(f,0);else return e;f=q.call(arguments,0);f[0]=e;for(var g=0,k=d.length;g<k;++g){var l=d[g].apply(this,f);void 0!==l&&h.push(l)}return e},
emitAfter:function(a,c,b,h){var e=m.Promise||w,f=[],d=+("number"==typeof a),g=new n(arguments[d]);g.result=f;var k;if(!(k=this._callbacks))return e.resolve(g);var l=k[g.type];k=k["*"];if(l&&l.length)l=k&&k.length?l.concat(k):l;else if(k&&k.length)l=k;else return e.resolve(g);k=l.length;var p=q.call(arguments,d);p[0]=g;for(d?d=0:a=0;d<k;++d)f[d]=y.call(this,l[d],p,a);return e.all(f).then(function(a){g.result=a;return g})},emitAsync:function(a,c,b){var h=m.Promise||w,e=new n(a),f=[];e.result=f;var d;
if(!(d=this._callbacks))return h.resolve(e);var g=d[e];d=d["*"];if(g&&g.length)g=d&&d.length?g.concat(d):g;else if(d&&d.length)g=d;else return h.resolve(e);d=g.length;var k=q.call(arguments,0);k[0]=e;for(var l=0;l<d;++l)f[l]=y.call(this,g[l],k);return h.all(f).then(function(a){e.result=a;return e})},bind:function(a){var c=m.prototype,b;for(b in c)v.call(c,b)&&"function"==typeof c[b]&&(a[b]=C.call(c[b],this));return a},hasListeners:function(a){a=p.call(this,a,!1);return!(!a||!a.length)},hasListener:function(a,
c){!c&&a&&(c=a,a="*");if("*"!=a){var b=p.call(this,a,!1);return!(!b||!~b.indexOf(c))}b=this._callbacks;for(var h in b)if(v.call(b,h)&&-1<b[h].indexOf(c))return!0;return!1},listeners:p});m.Event=n;return m});
