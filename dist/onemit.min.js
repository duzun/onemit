/*
 MIT
   @version 2.1.1
   @repo    https://github.com/duzun/onemit
*/
(function(m,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):(m=m||self,m.OnEmit=n())})(this,function(){function m(a){if(a)return t(a,m.prototype)}function n(a){if(!(this instanceof n))return new n(a);void 0==a&&(a="");"string"==typeof a&&(a={type:a});t(this,a);this.timeStamp=Date.now()}function q(a,c){var b=this._callbacks||(this._callbacks={}),h=a.type||String(a);return b[h]||c&&(b[h]=[])||[]}function x(a,c,b){var h=m.Promise||
v,e=this;b=+b;var f=y(b);return new h(function(d,g){f(function(){try{d(a.apply(e,c))}catch(k){g(k)}},b)})}function y(a){var c=a?m.setTimeout||A:m.setImmediate||B;c||a||(c=y(1));return c}function t(a,c){for(var b in c)u.call(c,b)&&(a[b]=c[b]);return a}function w(a){return a instanceof Function||"function"==typeof a}var p="undefined"==typeof globalThis?"undefined"==typeof global?self:global:globalThis,u={}.hasOwnProperty,C=u.bind,z=[],r=z.slice,D=z.splice,v="undefined"!=typeof Promise?Promise:p.Promise;
p="undefined"!==typeof self&&w(self.setTimeout)?self:p;w(p.setTimeout)||"undefined"!==typeof require&&(p=require("sdk/timers"));var A=p.setTimeout,B=p.setImmediate;t(n.prototype,{type:"*",toString:function(){return this.type}});t(m.prototype,{on:function(a,c){q.call(this,a,!0).push(c);return this},only:function(a,c){var b=q.call(this,a,!0);0>b.indexOf(c)&&b.push(c);return this},once:function(a,c){function b(){this.off(a,b);c.apply(this,arguments)}b.fn=c;return this.on(a,b)},off:function(a,c){var b=
this._callbacks;if(!b)return this;if(0==arguments.length)return b&&(this._callbacks={}),this;var h=b[a];if(!h)return this;if(1==arguments.length)return delete b[a],this;for(var e=h.length;e--;)b=h[e],b!==c&&b.fn!==c||D.call(h,e,1);return this},emit:function(a,c,b){var h=[],e=new n(a);e.result=h;var f;if(!(f=this._callbacks))return e;var d=f[e.type];f=f["*"];if(d&&d.length)d=f&&f.length?d.concat(f):r.call(d,0);else if(f&&f.length)d=r.call(f,0);else return e;f=r.call(arguments,0);f[0]=e;for(var g=0,
k=d.length;g<k;++g){var l=d[g].apply(this,f);void 0!==l&&h.push(l)}return e},emitAfter:function(a,c,b,h){var e=m.Promise||v,f=[],d=+("number"==typeof a),g=new n(arguments[d]);g.result=f;var k;if(!(k=this._callbacks))return e.resolve(g);var l=k[g.type];k=k["*"];if(l&&l.length)l=k&&k.length?l.concat(k):l;else if(k&&k.length)l=k;else return e.resolve(g);k=l.length;var p=r.call(arguments,d);p[0]=g;for(d?d=0:a=0;d<k;++d)f[d]=x.call(this,l[d],p,a);return e.all(f).then(function(a){g.result=a;return g})},
emitAsync:function(a,c,b){var h=m.Promise||v,e=new n(a),f=[];e.result=f;var d;if(!(d=this._callbacks))return h.resolve(e);var g=d[e];d=d["*"];if(g&&g.length)g=d&&d.length?g.concat(d):g;else if(d&&d.length)g=d;else return h.resolve(e);d=g.length;var k=r.call(arguments,0);k[0]=e;for(var l=0;l<d;++l)f[l]=x.call(this,g[l],k);return h.all(f).then(function(a){e.result=a;return e})},bind:function(a){var c=m.prototype,b;for(b in c)u.call(c,b)&&w(c[b])&&(a[b]=C.call(c[b],this));return a},hasListeners:function(a){a=
q.call(this,a,!1);return!(!a||!a.length)},hasListener:function(a,c){!c&&a&&(c=a,a="*");if("*"!=a){var b=q.call(this,a,!1);return!(!b||!~b.indexOf(c))}b=this._callbacks;for(var h in b)if(u.call(b,h)&&-1<b[h].indexOf(c))return!0;return!1},listeners:q});m.Event=n;return m});
