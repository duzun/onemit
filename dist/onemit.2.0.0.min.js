/*
 MIT
   @version 2.0.0
   @repo    https://github.com/duzun/onemit
*/
(function(A,r,x){function u(d,h){for(var b in h)v.call(h,b)&&(d[b]=h[b]);return d}function B(d,h){for(var b=d.length,n,a=1,g,c=arguments.length,e;a<c;++a)for(e=arguments[a],d.length=g=b+e.length,n=0;b<g;++b,++n)d[b]=e[n];return d}var w=x+"",v={}.hasOwnProperty,t=[].slice,C=[].splice,y=v.bind,D=typeof setTimeout!=w?setTimeout:r.setTimeout,E=typeof setImmediate!=w?setImmediate:r.setImmediate,z=typeof Promise!=w?Promise:r.Promise;("function"===typeof define&&define.amd?define:typeof module!=w&&module.exports?
function(d,h){module.exports=h()}:function(d,h){r[A]=h()})([],function(){function d(a){if(a)return u(a,d.prototype)}function h(a){if(!(this instanceof h))return new h(a);a==x&&(a="");"string"==typeof a&&(a={type:a});u(this,a);this.timeStamp=Date.now()}function b(a){var g=this._callbacks||(this._callbacks={});a=a.type||String(a);return"*"==a?g:g[a]||(g[a]=[])}function n(a,g,c){var e=d.Promise||z,f=this;c=+c;var m=!c&&(d.setImmediate||E)||d.setTimeout||D;return new e(function(e,d){m(function(){try{e(a.apply(f,
g))}catch(c){d(c)}},c)})}u(h.prototype,{type:"*",toString:function(){return this.type}});u(d.prototype,{on:function(a,g){b.call(this,a).push(g);return this},only:function(a,g){var c=b.call(this,a);0>c.indexOf(g)&&c.push(g);return this},once:function(a,g){function c(){this.off(a,c);g.apply(this,arguments)}c.fn=g;return this.on(a,c)},off:function(a,g){var c=this._callbacks;if(!c)return this;if(0==arguments.length)return c&&(this._callbacks={}),this;var e=c[a];if(!e)return this;if(1==arguments.length)return delete c[a],
this;for(var f=e.length;f--;)c=e[f],c!==g&&c.fn!==g||C.call(e,f,1);return this},emit:function(a,g,c){var e,f,d=[],q=new h(a);q.result=d;if(!(e=this._callbacks))return q;f=e[q.type];e=e["*"];if(f&&f.length)f=e&&e.length?f.concat(e):t.call(f,0);else if(e&&e.length)f=t.call(e,0);else return q;e=t.call(arguments,0);var b=f.length,l=0,k;for(e[0]=q;l<b;++l)k=f[l].apply(this,e),k!==x&&d.push(k);return q},emitAfter:function(a,g,c,e){var f=d.Promise||z,m,b,p=[],l=+("number"==typeof a),k=new h(arguments[l]);
k.result=p;if(!(m=this._callbacks))return f.resolve(k);b=m[k.type];m=m["*"];if(b&&b.length)b=m&&m.length?b.concat(m):b;else if(m&&m.length)b=m;else return f.resolve(k);m=b.length;var r=t.call(arguments,l);r[0]=k;for(l?l=0:a=0;l<m;++l)p[l]=n.call(this,b[l],r,a);return f.all(p).then(function(a){k.result=a;return k})},emitAsync:function(a,g,c){var e=d.Promise||z,f,b,q=[],p=new h(a);p.result=q;if(!(f=this._callbacks))return e.resolve(p);b=f[p];f=f["*"];if(b&&b.length)b=f&&f.length?b.concat(f):b;else if(f&&
f.length)b=f;else return e.resolve(p);f=b.length;var l=t.call(arguments,0),k=0;for(l[0]=p;k<f;++k)q[k]=n.call(this,b[k],l);return e.all(q).then(function(a){p.result=a;return p})},bind:function(a){var b=d.prototype,c;for(c in b)v.call(b,c)&&"function"==typeof b[c]&&(a[c]=y.call(b[c],this));return a},hasListeners:function(a){return!!b.call(this,a).length},hasListener:function(a,d){!d&&a&&(d=a,a="*");var c=b.call(this,a);if("*"!=a)return!!~c.indexOf(d);c;for(var e in c)if(v.call(c,e)&&-1<c[e].indexOf(d))return!0;
return!1},listeners:b});d.Event=h;return d});"function"!=typeof y&&(y=function(d){var h=t.call(arguments,1),b=this,n=function(){},a=h.length?function(){var a=arguments;return b.apply(this instanceof n&&d?this:d,a.length?B(h,a):h)}:function(){return b.apply(this instanceof n&&d?this:d,arguments)};n.prototype=b.prototype;a.prototype=new n;return a})})("OnEmit","undefined"==typeof self?"undefined"==typeof global?this:global:self);